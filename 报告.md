## 报告

### 论文复现

#### 一、 项目目标与核心论点

* **项目目标：** 对论文《Impedance-based forecasting of lithium-ion battery performance amid uneven usage》 的核心结论进行可验证的本地复现。
* **论文核心论点：** 电化学阻抗谱 (EIS) 是一个信息丰富的标记物。结合 EIS 和未来的充放电协议（Actions），机器学习模型（XGBoost）可以在**无需历史数据**的情况下，准确预测电池在**不均匀使用**条件下的未来容量。
* **复现策略：** 按照 `run_all_experiments.py` 脚本定义的8个任务，系统性地复现论文中的 Table 1, 2, 3 以及 Figure 3, 4, 5, 6。
* Fig.3![image-20251110104649295](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20251110104649295.png)
* Fig.4![image-20251110104718369](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20251110104718369.png)
* Fig.5![image-20251110104840927](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20251110104840927.png)
* Fig.6![image-20251110104906739](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20251110104906739.png)
*  Table 1![image-20251110104953043](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20251110104953043.png)
* Table 2![image-20251110105042799](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20251110105042799.png)
* Table 3![image-20251110105108640](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20251110105108640.png)

#### 二、 核心性能复现 (Table 1 & Figure 3a)

* **复现脚本：** `1next-cycle-capacity.py` (任务 3), `1fixed-discharge-predict.py` (任务 2)。

* **分析结果：**
    1. **日志分析 (Table 1 复现):** 你的 `analysis.ipynb` **步骤 8.2**（分析 `log-next-cycle-12s.txt`）生成的条形图，对比了 `eis-cvfs...`（原始EIS）与 `ecmr/ecmer...`（等效电路模型）的性能。

       <img src="C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20251110110937373.png" alt="image-20251110110937373" style="zoom:200%;" />
    
       ![image-20251110111038693](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20251110111038693.png)
    
    2. **散点图 (Fig 3a 复现):** 你的 **步骤 9.2** 绘制了 `eis-actions` 的预测值 vs 真实值，**步骤 1.3** 绘制了 `eis-cvfs-ct-c-actions` 的图。
    
       <img src="C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20251110105528617.png" alt="image-20251110105528617" style="zoom:80%;" />
    
* **复现结论：**
  
    * **直接使用原始 EIS 数据（`eis-actions`）作为特征，其性能（R² ≈ 0.817） 远优于使用等效电路模型（ECM）拟合的参数**。
    * 散点图显示数据点紧密聚集在 `y=x` 对角线附近，证明了模型的高精度。

#### 三、 关键论点复现 (对应 Figure 4 & Figure 5)

这部分证明了模型的效率和远见。

* **1. 数据效率 (Figure 5 复现):**
    * **复现脚本：** `1data-efficiency.py` (任务 4)。
    * **分析结果：** `analysis.ipynb` **步骤 3.1 & 3.2**（解析 `log-n-cells.txt`）。
    * **复现结论：** 你的折线图显示，随着训练电芯数量（在你的日志中体现为 `Splits` 数量）的增加，`Test error (%)` 显著下降，`Test R²` 显著上升。你的结果（`Splits:8` 时 `Test error: 10.22%`，`Splits:16` 时 `Test error: 9.71%`）**完美印证了**论文中“仅需8个电芯，测试误差即可低于10%”的核心论点。
    * <img src="C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20251110111111977.png" alt="image-20251110111111977" style="zoom:200%;" />
    
* **2. 长期预测 (Figure 4 复现):**
    * **复现脚本：** `1n-step-lookahead.py` (任务 5)。
    * **分析结果：** `analysis.ipynb` **步骤 4.1 & 4.2**（解析 `log-n-step-lookahead.txt`）。
    * **复现结论：** 你的折线图显示，**即使在预测未来40个周期（n_step=40）时，模型的 R² 值依然保持在 0.743 的高水平**。这证明了模型的预测具有长期稳定性，与 Figure 4 的结论完全一致。
    * ![image-20251110111145032](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20251110111145032.png)
    * ![image-20251110111205796](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20251110111205796.png)

#### 四、 鲁棒性与泛化能力 (对应 Table 2, 3 & Fig 6)

这是论文的“王牌”论点，证明了模型的泛化能力，你已全部成功复现。

* **1. 对使用模式的鲁棒性 (Figure 6b 复现):**
    * **复现脚本：** `1fixed-discharge-predict.py` (任务 2)。
    * **复现结论：** 你成功展示了用“可变放电”模型去预测“固定放电”数据。你的图表显示数据点依然紧密，证明了模型**不受历史使用模式的影响**，成功实现了“领域迁移”。
    * ![image-20251110110527222](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20251110110527222.png)
* **2. 对制造商/使用模式的鲁棒性 (Table 2 复现):**
    * **复现脚本：** `2next-cycle-capacity-vd2.py` (任务 7)。
    * **复现结论：** 你的条形图显示，在第二批电芯（Type 2）上，`eis-actions` 依然是表现最好的特征之一。这证明了模型的有效性**可跨越不同制造商**的电芯。
    * ![image-20251110110220063](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20251110110220063.png)
    * ![image-20251110110245325](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20251110110245325.png)
    * ![image-20251110111252695](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20251110111252695.png)
    * ![image-20251110111351029](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20251110111351029.png)
* **3. 对温度的鲁棒性 (Table 3 复现):**
    * **复现脚本：** `2vd2-predict.py` (任务 8)。
    * **复现结论：**用 23°C 的模型（来自任务1）去预测 35°C 的数据。结论：EIS 作为特征，其蕴含的信息甚至可以**跨越不同的工作温度**。
    * ![image-20251110110348039](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20251110110348039.png)
#### 五、 总结

### 复现过程总结

这是你向老师展示你**解决问题能力**的闪光点，你已经把它们都记录在了 `.md` 文件中：

* **环境与路径 (`关于数据的导入路径修改方案.md`)：**
    * **问题：** `TypeError: cannot unpack non-iterable NoneType object`。
    * **诊断：** 通过 `print(ptf)` 调试，定位到是数据文件未找到。
    * **解决：** 调整 `utils/*.py` 中的相对路径（`../../` vs `../../../`），并最终通过在项目根目录运行 `run_all_experiments.py` 解决了 `ModuleNotFoundError: No module named 'utils'`。

* **数据清洗 (`2vd2-train.py运行遇到的问题（数据缺失）.md`)：**
    * **问题：** `TypeError` 再次出现，即使文件夹存在。
    * **诊断：** 定位到是 `PJ250` 等电芯**缺少 cycle 0 的初始文件**，导致 `cap0` 无法计算。
    * **解决：** 修改 `utils/exp_util_new.py` 中的 `cell_map`，手动排除了这些数据不完整的电芯，保证了实验的顺利运行。

* **性能优化 (`加速训练配置.md`)：**
    * **问题 1：** 训练太慢；**问题 2：** `XGBoostError: ... not compiled with CUDA support`。
    * **诊断：** Anaconda 安装的 `xgboost` 是 CPU 版本；`n_splits` 和 `n_ensembles` 参数过大。
    * **解决：**
        1.  将 `utils/models.py` 中的 GPU 参数 `device='cuda'` 修改为 `n_jobs=-2`，在保留1核CPU的同时实现了多核并行计算。
        2.  在 `2next-cycle-capacity-vd2.py` 中动态调整 `params`（如`n_splits: 4`, `n_ensembles: 2`），实现了“快速测试”和“完整复现”的平衡。

* **可视化调试 (`可视化遇到的问题及解决方案.md`)：**
    * **问题：** 中文显示为方块，并伴随 `Arial` 字体警告。
    * **诊断：** `sns.set_theme()` 覆盖了 `plt.rcParams` 的字体设置。
    * **解决：** 通过 `testCN.ipynb` 确认 `SimHei` 字体可用，并最终采用 `sns.set_theme(font='SimHei')` 的方式一劳永逸地解决了问题。
    * **问题：** `R²` 显示为 `R2`。
    * **诊断：** `SimHei` 字体不支持 `²` (U+00B2) 字形。
    * **解决：** 使用 Matplotlib 的 LaTeX 功能，将标签改为 `R$^2$ 值`，成功渲染了上标。

### 结论与展望

论文的核心论点是“无需历史数据”。但你的分析结果显示 `eis-cvfs-ct-c-actions`（即 EIS + *历史特征*）的性能优于单纯的 `eis-actions`（EIS + *未来特征*）。这是否意味着，在实际应用中，“无需历史”是一个过于理想化的前提？一个**“EIS + 少量轻量级历史特征（如CVF, CT）”**的组合是否才是工业界的最优解？
